<!DOCTYPE HTML>
<html lang="en" class="ayu sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Upgrading from a previous version - Erigon 3 Docs</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Erigon 3 documentation!">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Erigon 3 Docs</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/erigontech/erigon" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="upgrading-from-a-previous-version"><a class="header" href="#upgrading-from-a-previous-version">Upgrading from a previous version</a></h1>
<p>Updating to the latest version of Erigon gives you access to the latest features and ensures optimal performance and stability.</p>
<h2 id="general-recommendations-before-upgrade"><a class="header" href="#general-recommendations-before-upgrade">General Recommendations Before Upgrade</a></h2>
<ul>
<li><strong>Read Release Notes</strong>: Carefully review the <a href="https://github.com/erigontech/erigon/releases">Release Notes</a> for breaking changes and new features relevant to your setup.</li>
<li><strong>Terminate your Erigon</strong>: End your current Erigon session by pressing <code>CTRL+C</code>.</li>
<li><strong>Backup</strong>: Always back up your <code>datadir</code> before performing major upgrades.</li>
</ul>
<h2 id="managing-your-data"><a class="header" href="#managing-your-data">Managing your Data</a></h2>
<p>Erigon 3.1 introduces a new snapshot format while continuing to support the old one. This means that new releases are fully compatible with your existing data. However, users who want the latest data files and data-specific fixes can perform an <strong>optional</strong> manual data upgrade:</p>
<ol>
<li>Backup your datadir.</li>
<li><a href="#upgrading-your-erigon-installation">Upgrade your Erigon installation</a> whether from a binary, compiled source code, or Docker.</li>
<li>To initiate the data upgrade, use the following command: <code>./build/bin/erigon snapshots reset --datadir /your/datadir</code>.</li>
<li>Run Erigon, it will reuse existing data and sync only newer snapshots.</li>
</ol>
<h3 id="snapshots-upgrade-options"><a class="header" href="#snapshots-upgrade-options">Snapshots Upgrade Options</a></h3>
<ul>
<li><code>erigon update-to-new-ver-format --datadir /your/datadir</code>: this option updates snapshots to be compatible with latest version, but you will not get the full benefits of the new snapshots.</li>
<li><code>erigon snapshots reset --datadir /your/datadir</code>: this command removes all old snapshots that have had performance improvements.</li>
</ul>
<p>Choose <code>upgrade</code> for a quicker process, or <code>reset</code> for maximum performance. If you choose <code>reset</code>, you'll need to wait for the new snapshots to download once Erigon starts.</p>
<blockquote>
<p>For more information see also <a href="#why-upgrading-erigon-doesnt-always-fix-your-data">Why Upgrading Erigon Doesn't Always Fix Your Data</a>.</p>
</blockquote>
<h3 id="snapshots-downgrade-options"><a class="header" href="#snapshots-downgrade-options">Snapshots Downgrade Options</a></h3>
<p>If upgrading snapshots(<code>3.0</code>to <code>3.1</code>) now happens automatically, you should follow these instructions for downgrading:</p>
<blockquote>
<p><strong>WARNING</strong>: This algorithm will remove incompatible <code>3.1</code> snapshot files because they are not backward-compatible.</p>
</blockquote>
<ol>
<li>Make sure that you're running erigon on 3.1.x version, use <code>erigon --version</code>.</li>
<li>Run <code>erigon --datadir ../your/datadir reset-to-old-ver-format</code> to reset your snapshots to old format.</li>
<li><code>git checkout v3.0.x</code> to checkout to preferred <code>3.0</code> version. For example now latest: <code>git checkout v3.0.15</code></li>
<li>Run your old version of Erigon.</li>
</ol>
<h2 id="upgrading-your-erigon-installation"><a class="header" href="#upgrading-your-erigon-installation">Upgrading your Erigon Installation</a></h2>
<p>Follow the below instructions depending on your installation method:</p>
<ul>
<li><a href="#pre-built-binaries">Pre-built binaries</a></li>
<li><a href="#docker">Docker</a></li>
<li><a href="#compiled-from-source">Compiled source code</a></li>
</ul>
<h3 id="pre-built-binaries"><a class="header" href="#pre-built-binaries">Pre-built Binaries</a></h3>
<p>Download the latest binary file from <a href="https://github.com/erigontech/erigon/releases">https://github.com/erigontech/erigon/releases</a>, do the <a href="../installation/prebuilt.html#checksums">checksum</a> and reinstall it, no other operation needed.</p>
<h3 id="docker"><a class="header" href="#docker">Docker</a></h3>
<p>If you're using Docker to run Erigon, the process to upgrade to a newer version of the software is straightforward and revolves around pulling the latest Docker image and then running it. Here's how you can upgrade Erigon using Docker:</p>
<ul>
<li>
<p><strong>Pull the Latest Docker Image</strong>: First, find out the tag of the new release from the <a href="https://hub.docker.com/r/erigontech/erigon">Erigon Docker Hub</a>. Once you know the tag, pull the new image:</p>
<pre><code class="language-bash">docker pull erigontech/erigon:&lt;new_version_tag&gt;
</code></pre>
<p>Replace &lt;new_version_tag&gt; with the actual version tag you wish to use. For example:</p>
<pre><code class="language-bash">docker pull erigontech/erigon:v3.1.0-rc1
</code></pre>
</li>
<li>
<p><strong>List Your Docker Images</strong>: Check your downloaded images to confirm the new image is there and get the new image ID:</p>
<pre><code class="language-bash">docker images
</code></pre>
</li>
<li>
<p><strong>Stop the Running Erigon Container</strong>: If you have a currently running Erigon container, you'll need to stop it before you can start the new version. First, find the container ID by listing the running containers:</p>
<pre><code class="language-bash">docker ps
</code></pre>
<p>Then stop the container using:</p>
<pre><code class="language-bash">docker stop &lt;container_id&gt;
</code></pre>
<p>Replace <code>&lt;container_id&gt;</code> with the actual ID of the container running Erigon.</p>
</li>
<li>
<p><strong>Remove the Old Container</strong>: (Optional) If you want to clean up, you can remove the old container after stopping it:</p>
<pre><code class="language-bash">docker rm &lt;container_id&gt;
</code></pre>
</li>
<li>
<p><strong>Run the New Image</strong>: Now you can start a new container with the new Erigon version using the new image ID:</p>
<pre><code class="language-bash">docker run -it &lt;new_image_id&gt; [options]
</code></pre>
</li>
<li>
<p><strong>Verify Operation</strong>: Ensure that Erigon starts correctly and connects to the desired network, verifying the logs for any initial errors.</p>
</li>
</ul>
<p>By following these steps, you'll keep your Docker setup clean and up-to-date with the latest Erigon version without needing to manually clean up or reconfigure your environment.</p>
<h3 id="compiled-from-source"><a class="header" href="#compiled-from-source">Compiled from source</a></h3>
<p>To upgrade Erigon to a newer version when you've originally installed it via Git and manual compilation, you should follow these steps without needing to delete the entire folder:</p>
<ul>
<li>
<p><strong>Navigate to your Erigon directory</strong>:</p>
<p>For example:</p>
<pre><code class="language-bash">cd erigon
</code></pre>
</li>
<li>
<p><strong>Fetch the latest changes from the repository</strong>: You need to make sure your local repository is up-to-date with the main GitHub repository. Run:</p>
<pre><code class="language-bash">git fetch --tags
</code></pre>
</li>
<li>
<p><strong>Check out</strong> the <a href="https://github.com/erigontech/erigon/releases">latest version</a> and switch to it using:</p>
<pre><code class="language-bash">git checkout &lt;new_version_tag&gt;
</code></pre>
<p>Replace <code>&lt;new_version_tag&gt;</code> with the version tag of the new release, for example:</p>
<pre><code class="language-bash">git checkout v3.1.0
</code></pre>
</li>
<li>
<p><strong>Rebuild Erigon</strong>: Since the codebase has changed, you need to compile the new version. Run:</p>
<pre><code class="language-bash">make erigon
</code></pre>
</li>
</ul>
<p>This process updates your installation to the latest version you specify, while maintaining your existing data. You're essentially just replacing the executable with a newer version.</p>
<h2 id="why-upgrading-erigon-doesnt-always-fix-your-data"><a class="header" href="#why-upgrading-erigon-doesnt-always-fix-your-data">Why Upgrading Erigon Doesn't Always Fix Your Data</a></h2>
<p>Upgrading Erigon involves a key distinction between its core software and its data files, which are managed separately. This approach is rooted in practicality and user control.</p>
<p>The Erigon <strong>software</strong> is the application that processes and interacts with blockchain data. However, the majority of the data itself, including the state of the network, exists in <strong>data files</strong> that you download and store locally.</p>
<p>If a bug is discovered, it is often in the data itself rather than a flaw in the Erigon code. In such a case, simply updating the Erigon binary won't resolve the issue because the faulty data remains on your disk. This is because Erigon upgrades do not normally alter the data files. You must reset and re-download the data snapshots to get the corrected files.</p>
<p>This separation prevents unnecessary and time-consuming processes. The Erigon team cannot regenerate months of data for every minor bug fix, and users shouldn't have to re-download terabytes of information with every new weekly software release.</p>
<p>This design also provides flexibility. A user might need a specific data fix but prefer to remain on an older software version due to a known bug or regression in the latest release. Similarly, a user might be satisfied with their current data set and only need to update the Erigon binary.</p>
<p>While this dual-versioning system may seem complex, it is a deliberate design choice that optimizes for both efficiency and user autonomy.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../getting-started/installation/docker.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../getting-started/installation/migrating-from-geth.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../getting-started/installation/docker.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../getting-started/installation/migrating-from-geth.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
