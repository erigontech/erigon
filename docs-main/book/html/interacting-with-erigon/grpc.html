<!DOCTYPE HTML>
<html lang="en" class="ayu sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>gRPC - Erigon 3 Docs</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Erigon 3 documentation!">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Erigon 3 Docs</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/erigontech/erigon" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="grpc-api-guide"><a class="header" href="#grpc-api-guide"><code>gRPC</code> API Guide</a></h1>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>Erigon provides gRPC APIs that allow users to access blockchain data and services directly through protocol buffer interfaces. These APIs offer high-performance, strongly-typed access to Erigon's internal services and are particularly useful for applications requiring efficient data access or integration with other gRPC-based systems.</p>
<p>The gRPC server must be explicitly enabled using the <code>--grpc</code> flag when starting the RPC daemon, and can be configured with custom listening addresses, ports, and TLS settings.</p>
<h3 id="performance-considerations"><a class="header" href="#performance-considerations">Performance Considerations</a></h3>
<ul>
<li>gRPC APIs provide better performance than JSON-RPC for high-throughput applications</li>
<li>Direct database access via KV interface offers the fastest data retrieval</li>
<li>Shared memory access (when running locally) provides optimal performance</li>
</ul>
<h3 id="data-format-and-buckets"><a class="header" href="#data-format-and-buckets">Data Format and Buckets</a></h3>
<p>Database bucket names and their formats are documented in <code>db/kv/tables.go</code>. Understanding these structures is essential for effective use of the KV interface.</p>
<h3 id="network-access"><a class="header" href="#network-access">Network Access</a></h3>
<ul>
<li>gRPC services can be accessed over the network when properly configured</li>
<li>TLS encryption is recommended for production deployments</li>
<li>Rate limiting can be configured via <code>--private.api.ratelimit</code> flag</li>
</ul>
<h3 id="integration-libraries"><a class="header" href="#integration-libraries">Integration Libraries</a></h3>
<p>Erigon provides Go, Rust, and C++ implementations of the RoKV (read-only key-value) interface for easy integration with applications.</p>
<h3 id="availability"><a class="header" href="#availability">Availability</a></h3>
<ul>
<li>gRPC services are available when enabled with the <code>--grpc</code> flag</li>
<li>Default listening address is configurable via <code>--grpc.addr</code> and <code>--grpc.port</code></li>
<li>Services require the main Erigon node to be running and accessible</li>
</ul>
<p>For more information, visit the <a href="https://github.com/erigontech/interfaces">Erigon Interfaces GitHub repository</a>.</p>
<hr />
<h2 id="kv-key-value-interface"><a class="header" href="#kv-key-value-interface"><strong>KV (Key-Value) Interface</strong></a></h2>
<p>The KV interface provides low-level database access methods for reading blockchain data directly from Erigon's MDBX database.</p>
<p><strong>Interface Definition</strong></p>
<p>The KV interface is defined in the remote protobuf specification and provides methods for:</p>
<ul>
<li>Opening read-only transactions</li>
<li>Reading data by key ranges</li>
<li>Iterating over database buckets</li>
<li>Accessing historical state data</li>
</ul>
<p><strong>Example Usage</strong></p>
<pre><code class="language-bash"># Connect to gRPC endpoint
grpcurl -plaintext localhost:9090 remote.KV/Version
</code></pre>
<p><strong>Available Methods</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Method</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">Version</td><td style="text-align: left">Returns the KV service API version</td></tr>
<tr><td style="text-align: left">Tx</td><td style="text-align: left">Opens a read-only transaction for data access</td></tr>
<tr><td style="text-align: left">StateChanges</td><td style="text-align: left">Streams state changes for a block range</td></tr>
<tr><td style="text-align: left">Snapshots</td><td style="text-align: left">Returns information about available snapshots</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="ethbackend-interface"><a class="header" href="#ethbackend-interface"><strong>ETHBACKEND Interface</strong></a></h2>
<p>The ETHBACKEND interface provides access to Ethereum-specific backend services including block data, transaction information, and network status.</p>
<p><strong>Available Services</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Service</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">Etherbase</td><td style="text-align: left">Returns the coinbase address</td></tr>
<tr><td style="text-align: left">NetVersion</td><td style="text-align: left">Returns the network ID</td></tr>
<tr><td style="text-align: left">NetPeerCount</td><td style="text-align: left">Returns the number of connected peers</td></tr>
<tr><td style="text-align: left">ProtocolVersion</td><td style="text-align: left">Returns the Ethereum protocol version</td></tr>
<tr><td style="text-align: left">ClientVersion</td><td style="text-align: left">Returns the client version string</td></tr>
<tr><td style="text-align: left">Subscribe</td><td style="text-align: left">Subscribes to blockchain events</td></tr>
<tr><td style="text-align: left">NodeInfo</td><td style="text-align: left">Returns node information</td></tr>
<tr><td style="text-align: left">Peers</td><td style="text-align: left">Returns information about connected peers</td></tr>
<tr><td style="text-align: left">AddPeer</td><td style="text-align: left">Adds a peer to the node</td></tr>
<tr><td style="text-align: left">PendingBlock</td><td style="text-align: left">Returns the pending block</td></tr>
<tr><td style="text-align: left">BorEvent</td><td style="text-align: left">Returns Bor-specific events (Polygon networks only)</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="txpool-interface"><a class="header" href="#txpool-interface"><strong>TxPool Interface</strong></a></h2>
<p>The TxPool interface provides access to transaction pool operations and status information.</p>
<p><strong>Available Methods</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Method</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">Version</td><td style="text-align: left">Returns the TxPool service version</td></tr>
<tr><td style="text-align: left">FindUnknownHashes</td><td style="text-align: left">Finds unknown transaction hashes</td></tr>
<tr><td style="text-align: left">GetTransactions</td><td style="text-align: left">Retrieves transactions from the pool</td></tr>
<tr><td style="text-align: left">All</td><td style="text-align: left">Returns all transactions in the pool</td></tr>
<tr><td style="text-align: left">PendingAdd</td><td style="text-align: left">Adds transactions to pending pool</td></tr>
<tr><td style="text-align: left">PendingRemove</td><td style="text-align: left">Removes transactions from pending pool</td></tr>
<tr><td style="text-align: left">OnAdd</td><td style="text-align: left">Subscribes to transaction addition events</td></tr>
<tr><td style="text-align: left">Mining</td><td style="text-align: left">Returns mining-related transaction data</td></tr>
<tr><td style="text-align: left">NonceFromAddress</td><td style="text-align: left">Gets the next nonce for an address</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="downloader-interface"><a class="header" href="#downloader-interface"><strong>Downloader Interface</strong></a></h2>
<p>The Downloader interface provides access to snapshot downloading and torrent management functionality.</p>
<p><strong>Available Methods</strong></p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Method</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left">Add</td><td style="text-align: left">Adds files to download queue</td></tr>
<tr><td style="text-align: left">Delete</td><td style="text-align: left">Removes files from download queue</td></tr>
<tr><td style="text-align: left">Completed</td><td style="text-align: left">Checks if downloads are completed</td></tr>
<tr><td style="text-align: left">SetLogPrefix</td><td style="text-align: left">Sets logging prefix for downloader</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="polygon-bridge-backend-grpc-api"><a class="header" href="#polygon-bridge-backend-grpc-api">Polygon Bridge Backend gRPC API</a></h2>
<p>These gRPC APIs are specifically designed for Polygon's Bor consensus mechanism and are only active when running Erigon with Polygon network configuration. The services provide essential functionality for bridge event processing and validator management required by the Polygon network architecture.</p>
<h3 id="bridge-backend-methods"><a class="header" href="#bridge-backend-methods">Bridge Backend Methods</a></h3>
<p><strong>Version Method:</strong></p>
<ul>
<li><code>Version()</code> - Returns the service version number.</li>
</ul>
<p><strong>Transaction Lookup:</strong></p>
<ul>
<li><code>BorTxnLookup(BorTxnLookupRequest)</code> - Looks up Bor transaction information by hash.</li>
</ul>
<p><strong>Event Retrieval:</strong></p>
<ul>
<li><code>BorEvents(BorEventsRequest)</code> - Retrieves bridge events for a specific block.</li>
</ul>
<h3 id="bridge-backend-implementation"><a class="header" href="#bridge-backend-implementation">Bridge Backend Implementation</a></h3>
<p>The server implementation is found in <code>polygon/bridge/server.go</code> where the <code>BackendServer</code> struct implements the <code>BridgeBackendServer</code> interface:</p>
<ul>
<li>
<p>The <code>BorTxnLookup</code> method implementation shows how it handles transaction lookups.</p>
</li>
<li>
<p>The <code>BorEvents</code> method retrieves bridge events for a given block.</p>
</li>
</ul>
<h2 id="heimdall-backend-grpc-api"><a class="header" href="#heimdall-backend-grpc-api">Heimdall Backend gRPC API</a></h2>
<p>The Heimdall Backend service provides APIs for validator and consensus-related functionality.</p>
<h3 id="heimdall-backend-methods"><a class="header" href="#heimdall-backend-methods">Heimdall Backend Methods</a></h3>
<p><strong>Version Method:</strong></p>
<ul>
<li><code>Version()</code> - Returns the service version number.</li>
</ul>
<p><strong>Producer Information:</strong></p>
<ul>
<li><code>Producers(BorProducersRequest)</code> - Retrieves validator/producer information for a specific block.</li>
</ul>
<h2 id="service-integration"><a class="header" href="#service-integration">Service Integration</a></h2>
<p>Both services are integrated into the main Ethereum backend when Bor consensus is configured. In the main backend initialization, you can see how these services are set up.</p>
<p>The Bridge and Heimdall services are created with their respective RPC servers.</p>
<hr />
<h2 id="configuration-and-security"><a class="header" href="#configuration-and-security">Configuration and Security</a></h2>
<h3 id="tls-configuration"><a class="header" href="#tls-configuration">TLS Configuration</a></h3>
<p>Erigon supports TLS encryption for gRPC connections using certificate files:</p>
<pre><code class="language-bash">./build/bin/rpcdaemon --grpc --tls.cert=/path/to/cert.pem --tls.key=/path/to/key.pem --tls.cacert=/path/to/ca.pem
</code></pre>
<h3 id="health-checks"><a class="header" href="#health-checks">Health Checks</a></h3>
<p>gRPC health checks can be enabled to monitor service availability:</p>
<pre><code class="language-bash">./build/bin/rpcdaemon --grpc --grpc.healthcheck
</code></pre>
<h3 id="connection-examples"><a class="header" href="#connection-examples">Connection Examples</a></h3>
<p><strong>Go Client Example</strong></p>
<pre><code class="language-go">conn, err := grpc.Dial("localhost:9090", grpc.WithInsecure())
if err != nil {
    log.Fatal(err)
}
defer conn.Close()

client := remote.NewKVClient(conn)
// Use client for database operations
</code></pre>
<p><strong>Direct Database Access</strong></p>
<p>The gRPC interface allows reading Erigon's database while the node is running, sharing the same OS-level PageCache for optimal performance.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../interacting-with-erigon/internal.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../staking/staking.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../interacting-with-erigon/internal.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../staking/staking.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
