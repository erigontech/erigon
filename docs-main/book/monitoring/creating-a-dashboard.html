<!DOCTYPE HTML>
<html lang="en" class="ayu sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Creating a dashboard - Erigon 3 Docs</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Erigon 3 documentation!">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Erigon 3 Docs</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/erigontech/docs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="creating-a-dashboard"><a class="header" href="#creating-a-dashboard">Creating a dashboard</a></h1>
<p>You can set up monitoring for Erigon using Grafana and Prometheus. Erigon has built-in support for this monitoring stack with pre-configured dashboards and metrics collection. This guide will walk you through setting up a complete monitoring dashboard for Erigon using Prometheus and Grafana, leveraging the built-in monitoring tools provided in the Erigon codebase.</p>
<p>The monitoring setup leverages Erigon's built-in metrics system and provides comprehensive visibility into node performance, storage usage, and network activity. The pre-configured dashboards are actively maintained and include metrics for both execution and consensus layer operations when running with Caplin.</p>
<h2 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h2>
<ul>
<li>Docker and Docker Compose installed</li>
<li>Erigon node running</li>
<li>Basic understanding of Prometheus and Grafana</li>
</ul>
<h2 id="step-1-enable-metrics-in-erigon"><a class="header" href="#step-1-enable-metrics-in-erigon">Step 1: Enable Metrics in Erigon</a></h2>
<p>First, you need to enable metrics collection in your Erigon instance by adding the <code>--metrics</code> flag.</p>
<pre><code class="language-bash">./erigon --metrics --datadir=/your/data/dir
</code></pre>
<p>If you need to specify a custom metrics address, use <code>--metrics.addr</code>.</p>
<h2 id="step-2-configure-prometheus-targets"><a class="header" href="#step-2-configure-prometheus-targets">Step 2: Configure Prometheus Targets</a></h2>
<p>Add your Erigon hosts to the Prometheus configuration file:</p>
<ol>
<li>Copy the default configuration: <code>./cmd/prometheus/prometheus.yml</code></li>
<li>Edit the file to include your Erigon instance endpoints</li>
<li>Save the modified configuration file</li>
</ol>
<h2 id="step-3-launch-monitoring-stack"><a class="header" href="#step-3-launch-monitoring-stack">Step 3: Launch Monitoring Stack</a></h2>
<p>Erigon provides a simple Docker Compose setup for the monitoring stack:</p>
<pre><code class="language-bash">docker compose up -d prometheus grafana
</code></pre>
<p>Alternatively, you can use the make target <a href="#0-2">3</a> :</p>
<pre><code class="language-bash">make prometheus
</code></pre>
<h2 id="step-4-access-grafana-dashboard"><a class="header" href="#step-4-access-grafana-dashboard">Step 4: Access Grafana Dashboard</a></h2>
<p>Once the containers are running, access Grafana at <a href="http://localhost:3000">localhost:3000</a>.</p>
<p><strong>Default credentials:</strong> <code>admin/admin</code></p>
<h2 id="step-5-pre-configured-dashboards"><a class="header" href="#step-5-pre-configured-dashboards">Step 5: Pre-configured Dashboards</a></h2>
<p>Erigon comes with comprehensive pre-built dashboards that monitor various aspects of the node:</p>
<h3 id="main-dashboard-features"><a class="header" href="#main-dashboard-features">Main Dashboard Features</a></h3>
<p>The <code>erigon_internals.json</code> dashboard <a href="#0-4">5</a>  includes panels for:</p>
<ul>
<li><strong>Storage Monitoring</strong>: Snapshots, chaindata, and temp directory sizes</li>
<li><strong>Block Processing</strong>: Block importing latency and execution times</li>
<li><strong>Network Activity</strong>: Gossip bandwidth and P2P metrics</li>
<li><strong>State Management</strong>: Domain operations and pruning statistics</li>
</ul>
<h3 id="key-metrics-to-monitor"><a class="header" href="#key-metrics-to-monitor">Key Metrics to Monitor</a></h3>
<ol>
<li><strong>Block Execution Speed</strong></li>
<li><strong>Storage Growth</strong> - Monitor chaindata and snapshot sizes</li>
<li><strong>Processing Times</strong> - Track validation and execution latencies</li>
</ol>
<h2 id="step-6-environment-configuration"><a class="header" href="#step-6-environment-configuration">Step 6: Environment Configuration</a></h2>
<p>You can customize the setup using environment variables:</p>
<ul>
<li><code>XDG_DATA_HOME</code>: Changes default database folder location</li>
<li><code>ERIGON_PROMETHEUS_CONFIG</code>: Path to custom prometheus.yml file</li>
<li><code>ERIGON_GRAFANA_CONFIG</code>: Path to custom grafana.ini file</li>
</ul>
<p>Example with custom configuration:</p>
<pre><code class="language-bash">ERIGON_PROMETHEUS_CONFIG=/path/to/custom/prometheus.yml docker compose up prometheus grafana
</code></pre>
<h2 id="step-7-adding-custom-hosts"><a class="header" href="#step-7-adding-custom-hosts">Step 7: Adding Custom Hosts</a></h2>
<p>To monitor multiple Erigon instances:</p>
<ol>
<li>Copy <code>./cmd/prometheus/prometheus.yml</code></li>
<li>Add your additional Erigon hosts to the targets</li>
<li>Use the custom config: <code>ERIGON_PROMETHEUS_CONFIG=/new/location/prometheus.yml docker compose up prometheus grafana</code></li>
</ol>
<h2 id="step-8-memory-usage-monitoring"><a class="header" href="#step-8-memory-usage-monitoring">Step 8: Memory Usage Monitoring</a></h2>
<p>The dashboard includes proper memory usage tracking that accounts for OS page cache. This is important because standard tools like <code>htop</code> can be misleading for Erigon memory usage.</p>
<h2 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h2>
<ul>
<li>Ensure Erigon is running with <code>--metrics</code> flag enabled</li>
<li>Verify Prometheus can reach your Erigon metrics endpoint (default port varies)</li>
<li>Check Docker container logs if services fail to start</li>
<li>Confirm firewall settings allow access to monitoring ports</li>
</ul>
<h2 id="developers"><a class="header" href="#developers">Developers</a></h2>
<p>For developers wanting to add custom metrics, examples can be found in the codebase, and gRPC metrics are available by searching for <code>grpc_prometheus.Register</code> in the code.</p>
<!--
### Citations

**File:** cmd/prometheus/Readme.md (L1-1)
```markdown
Add flag `--metrics` to Erigon or any other process (add `--metrics.addr` if need).
```

**File:** cmd/prometheus/Readme.md (L3-3)
```markdown
Add hosts to collecting metrics in: `./cmd/prometheus/prometheus.yml`
```

**File:** cmd/prometheus/Readme.md (L5-5)
```markdown
Run Grafana and Prometheus: `docker compose up -d prometheus grafana` or `make prometheus`
```

**File:** cmd/prometheus/Readme.md (L7-7)
```markdown
Go to: [localhost:3000](localhost:3000), admin/admin
```

**File:** cmd/prometheus/Readme.md (L9-13)
```markdown
Env variables:

- `XDG_DATA_HOME` re-defines default prometheus and grafana databases folder.
- `ERIGON_PROMETHEUS_CONFIG` path to custom `prometheus.yml` file. Default is: `./cmd/prometheus/prometheus.yml`
- `ERIGON_GRAFANA_CONFIG` path to custom `grafana.ini file`. Default is: `./cmd/prometheus/grafana.ini`
```

**File:** cmd/prometheus/Readme.md (L15-16)
```markdown
To add custom Erigon host: copy `./cmd/prometheus/prometheus.yml`, modify, pass new location by:
`ERIGON_PROMETHEUS_CONFIG=/new/location/prometheus.yml docker compose up prometheus grafana`
```

**File:** cmd/prometheus/Readme.md (L29-31)
```markdown
See example: `ethdb/object_db.go:dbGetTimer`

```

**File:** cmd/prometheus/dashboards/erigon_internals.json (L1-60)
```json
{
  "__inputs": [
    {
      "name": "DS_GRAFANACLOUD-ERIGONOVHMONITORING-PROM",
      "label": "grafanacloud-erigonovhmonitoring-prom",
      "description": "",
      "type": "datasource",
      "pluginId": "prometheus",
      "pluginName": "Prometheus"
    }
  ],
  "__elements": {},
  "__requires": [
    {
      "type": "panel",
      "id": "barchart",
      "name": "Bar chart",
      "version": ""
    },
    {
      "type": "panel",
      "id": "bargauge",
      "name": "Bar gauge",
      "version": ""
    },
    {
      "type": "panel",
      "id": "gauge",
      "name": "Gauge",
      "version": ""
    },
    {
      "type": "grafana",
      "id": "grafana",
      "name": "Grafana",
      "version": "12.1.0-91295"
    },
    {
      "type": "panel",
      "id": "piechart",
      "name": "Pie chart",
      "version": ""
    },
    {
      "type": "datasource",
      "id": "prometheus",
      "name": "Prometheus",
      "version": "1.0.0"
    },
    {
      "type": "panel",
      "id": "stat",
      "name": "Stat",
      "version": ""
    },
    {
      "type": "panel",
      "id": "timeseries",
      "name": "Time series",
      "version": ""
```

**File:** cmd/prometheus/dashboards/erigon_internals.json (L185-195)
```json
              "expr": "devops_erigon_dirs_size_total{directory=\"/erigon-data/snapshots\", instance=~\"$nodo\"}",
              "legendFormat": "__auto",
              "range": true,
              "refId": "A",
              "datasource": {
                "type": "prometheus",
                "uid": "${DS_GRAFANACLOUD-ERIGONOVHMONITORING-PROM}"
              }
            }
          ],
          "title": "<datadir>/SNAPSHOTS TOTAL SIZE (GB)",
```

**File:** cmd/prometheus/dashboards/erigon_internals.json (L282-292)
```json
              "expr": "devops_erigon_dirs_size_total{directory=\"/erigon-data/chaindata\", instance=~\"$nodo\"}",
              "legendFormat": "__auto",
              "range": true,
              "refId": "A",
              "datasource": {
                "type": "prometheus",
                "uid": "${DS_GRAFANACLOUD-ERIGONOVHMONITORING-PROM}"
              }
            }
          ],
          "title": "<datadir>/CHAINDATA size (GB)",
```

**File:** cmd/prometheus/dashboards/erigon_internals.json (L1867-1877)
```json
              "expr": "block_importing_latency{instance=~\"$instance\"}",
              "legendFormat": "{{label_name}} {{instance}}",
              "range": true,
              "refId": "A",
              "datasource": {
                "type": "prometheus",
                "uid": "${DS_GRAFANACLOUD-ERIGONOVHMONITORING-PROM}"
              }
            }
          ],
          "title": "Block importing latency",
```

**File:** cmd/prometheus/dashboards/erigon_internals.json (L2583-2593)
```json
              "expr": "execution_time{instance=~\"$instance\"}",
              "legendFormat": "{{label_name}} {{instance}}",
              "range": true,
              "refId": "A",
              "datasource": {
                "type": "prometheus",
                "uid": "${DS_GRAFANACLOUD-ERIGONOVHMONITORING-PROM}"
              }
            }
          ],
          "title": "ValidateChain: time spent",
```

**File:** cmd/prometheus/dashboards/erigon_internals.json (L3153-3166)
```json
              "expr": "rate(gossip_topics_seen_beacon_block{instance=~\"$instance\"}[$__rate_interval])/125 > 0  ",
              "fullMetaSearch": false,
              "includeNullMetadata": true,
              "legendFormat": "kb/s {{instance}}",
              "range": true,
              "refId": "A",
              "useBackend": false,
              "datasource": {
                "type": "prometheus",
                "uid": "${DS_GRAFANACLOUD-ERIGONOVHMONITORING-PROM}"
              }
            }
          ],
          "title": "Beacon Block Gossip bandwidth",
```

**File:** cmd/prometheus/dashboards/erigon_internals.json (L4324-4345)
```json
              "expr": "domain_running_files_building{instance=~\"$instance\"}",
              "hide": false,
              "instant": false,
              "legendFormat": "running files building: {{instance}}",
              "range": true,
              "refId": "E"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "${DS_GRAFANACLOUD-ERIGONOVHMONITORING-PROM}"
              },
              "editorMode": "code",
              "expr": "domain_wal_flushes{instance=~\"$instance\"}",
              "hide": false,
              "instant": false,
              "legendFormat": "WAL flushes {{instance}}",
              "range": true,
              "refId": "F"
            }
          ],
          "title": "State: running collate/merge/prune",
```

**File:** cmd/prometheus/dashboards/erigon_internals.json (L5716-5725)
```json
              "expr": "chain_execution_seconds{quantile=\"$quantile\",instance=~\"$instance\"}",
              "format": "time_series",
              "interval": "",
              "intervalFactor": 1,
              "legendFormat": "execution: {{instance}}",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Block Execution speed ",
```

**File:** README.md (L443-443)
```markdown
`docker compose up prometheus grafana`, [detailed docs](./cmd/prometheus/Readme.md).
```

**File:** README.md (L751-755)
```markdown
`htop` on column `res` shows memory of "App + OS used to hold page cache for given App", but it's not informative,
because if `htop` says that app using 90% of memory you still can run 3 more instances of app on the same machine -
because most of that `90%` is "OS pages cache".
OS automatically frees this cache any time it needs memory. Smaller "page cache size" may not impact performance of
Erigon at all.
```

**File:** README.md (L762-763)
```markdown
- `Prometheus` dashboard shows memory of Go app without OS pages cache (`make prometheus`, open in
  browser `localhost:3000`, credentials `admin/admin`)
```
-->
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../monitoring/monitoring.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../monitoring/understanding-dashboards.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../monitoring/monitoring.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../monitoring/understanding-dashboards.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
